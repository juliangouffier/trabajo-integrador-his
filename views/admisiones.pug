extends layout

block content
  .container.mt-5
    .d-flex.justify-content-between.align-items-center.mb-4
      h2.text-dark Nueva AdmisiÃ³n
      a.btn.btn-outline-primary(href='/admisiones/listado') Ver listado de admisiones

    .card.shadow-sm.border-0
      .card-body
        form(action='/admisiones/registro', method='POST')
          .mb-3
            label.form-label Paciente
            .d-flex.align-items-center.gap-3
              select#paciente-select.form-select(name='paciente', style='width: 100%;', required)
                option(value='') Buscar paciente por DNI
              a.btn.btn-outline-secondary(data-bs-toggle='modal', data-bs-target='#modalNuevoPaciente') Nuevo Paciente

          .mb-3
            label.form-label Fecha de ingreso
            input.form-control(type='date', name='fechaIngreso', required)

          .mb-3
            label.form-label Motivo
            input.form-control(type='text', name='motivo', placeholder='Ingrese motivo', required)

          .mb-3
            label.form-label Cama
            select.form-select(name='cama', required)
              optgroup(label='Sector A')
                option(value='C01-100') Cama 01 â€“ HabitaciÃ³n 100
                option(value='C02-100') Cama 02 â€“ HabitaciÃ³n 100
              optgroup(label='Sector B')
                option(value='C01-200') Cama 01 â€“ HabitaciÃ³n 200

          .mb-3
            label.form-label Estado
            select.form-select(name='estado', required)
              option(value='Activo') Activa
              option(value='Cancelada') Cancelada
              option(value='Alta') Alta

          button.btn.btn-primary.w-100(type='submit') Registrar AdmisiÃ³n

  // MODAL NUEVO PACIENTE
  .modal.fade(id='modalNuevoPaciente' tabindex='-1')
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Nuevo Paciente
          button.btn-close(type='button', data-bs-dismiss='modal')
        .modal-body
          form(action='/pacientes/crear', method='POST')
            .row
              .col-md-6.mb-3
                label.form-label DNI
                input.form-control(type='text', name='dni', required)
              .col-md-6.mb-3
                label.form-label Nombre
                input.form-control(type='text', name='nombre', required)
            .row
              .col-md-6.mb-3
                label.form-label Apellido
                input.form-control(type='text', name='apellido', required)
              .col-md-6.mb-3
                label.form-label Sexo
                select.form-select(name='sexo', required)
                  option(value='') Seleccionar
                  option(value='M') Masculino
                  option(value='F') Femenino
                  option(value='O') Otro
            .mb-3
              label.form-label Fecha de nacimiento
              input.form-control(type='date', name='fechaNacimiento', required)
            .mb-3
              label.form-label DirecciÃ³n
              input.form-control(type='text', name='direccion', required)
            .mb-3
              label.form-label TelÃ©fono
              input.form-control(type='text', name='telefono', required)
            .mb-3
              label.form-label Contacto de emergencia
              input.form-control(type='text', name='contactoEmergencia')

            .d-flex.justify-content-end.mt-3
              button.btn.btn-outline-secondary(type='button', data-bs-dismiss='modal') Cancelar
              button.btn.btn-primary.ms-2(type='submit') Guardar

block scripts
  script(src='https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js')
  script(src='https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js')
  script.
    $(document).ready(function() {
      $('#paciente-select').select2({
        theme: 'bootstrap-5',
        placeholder: 'Buscar paciente por DNI',
        ajax: {
          url: '/pacientes/predict', // ðŸ‘ˆ este endpoint
          dataType: 'json',
          delay: 250,
          data: function (params) {
            return { search: params.term };
          },
          processResults: function (data) {
            return {
              results: data.map(p => ({
                id: p.id,
                text: `${p.dni} - ${p.nombre} ${p.apellido}`
              }))
            };
          }
        }
      });
    });
