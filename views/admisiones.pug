extends layout

block content
  .container.mt-5
    h2.text-dark.mb-4 Admisión de Pacientes

    .card.shadow-sm.border-0.p-4
      .card-body
        .mb-4
          label.form-label Buscar Paciente por DNI
          .input-group
            input.form-control(type='text', id='buscarDni', placeholder='Ingrese DNI')
            button.btn.btn-outline-primary(type='button', id='btnBuscarPaciente') Buscar

        form(id='form-admision', action='/admisiones/registro', method='POST')
          input(type='hidden', name='pacienteId', id='pacienteId')

          .row.mb-3
            .col-md-6
              label.form-label Nombre(s)*
              input.form-control(type='text', name='nombre', id='nombre', required)
            .col-md-6
              label.form-label Apellido(s)*
              input.form-control(type='text', name='apellido', id='apellido', required)

          .row.mb-3
            .col-md-4
              label.form-label Fecha de Nacimiento*
              input.form-control(type='date', name='fechaNacimiento', id='fechaNacimiento', required)
            .col-md-4
              label.form-label Género*
              select.form-select(name='genero', id='genero', required)
                option(value='') Seleccionar
                option(value='M') Masculino
                option(value='F') Femenino
                option(value='O') Otro
            .col-md-4
              label.form-label Documento*
              input.form-control(type='text', name='dni', id='dni', required)

          .row.mb-3
            .col-md-6
              label.form-label Contacto (Teléfono o Email)
              input.form-control(type='text', name='contacto', id='contacto')
            .col-md-6
              label.form-label Obra Social
              select.form-select(name='obraSocial', id='obraSocial')
                option(value='') Sin obra social

          .row.mb-3
            .col-md-6
              label.form-label Contacto de Emergencia
              input.form-control(type='text', name='contactoEmergencia', id='contactoEmergencia')
            .col-md-6
              label.form-label Notas Adicionales
              textarea.form-control(name='notas', id='notas')

          .row.mb-3
            .col-md-6.form-check
              input.form-check-input(type='checkbox', id='emergencia', name='emergencia')
              label.form-check-label(for='emergencia') Llegada por Emergencia
            .col-md-6.form-check
              input.form-check-input(type='checkbox', id='derivado', name='derivado')
              label.form-check-label(for='derivado') Paciente Derivado

          .row.mb-3
            .col-md-6
              label.form-label Fecha de Ingreso*
              input.form-control(type='date', name='fechaIngreso', required)
            .col-md-6
              label.form-label Motivo de Internación*
              input.form-control(type='text', name='motivo', required)

          .row.mb-3
            .col-md-6
              label.form-label Seleccionar Cama*
              select.form-select(name='cama', required)
                option(value='') Seleccione una cama disponible

          .row.mb-3
            .col-md-6
              label.form-label Estado de Internación*
              select.form-select(name='estado', required)
                option(value='Activo') Activa
                option(value='Cancelada') Cancelada
                option(value='Alta') Alta

          .d-flex.justify-content-end.mt-4
            a.btn.btn-outline-secondary(href='/home') Cancelar
            button.btn.btn-primary.ms-2(type='submit') Registrar Paciente

  block scripts
    script.
      document.getElementById('btnBuscarPaciente').addEventListener('click', async () => {
        const dni = document.getElementById('buscarDni').value.trim();
        if (!dni) return;
        try {
          const res = await fetch(`/pacientes/buscar?q=${dni}`);
          const pacientes = await res.json();
          if (pacientes.length > 0) {
            const p = pacientes[0];
            document.getElementById('pacienteId').value = p.id;
            document.getElementById('nombre').value = p.nombre;
            document.getElementById('apellido').value = p.apellido;
            document.getElementById('dni').value = p.dni;
            document.getElementById('fechaNacimiento').value = p.fechaNacimiento;
            document.getElementById('genero').value = p.genero;
            document.getElementById('contacto').value = p.contacto;
            document.getElementById('obraSocial').value = p.obraSocial;
            document.getElementById('contactoEmergencia').value = p.contactoEmergencia;
            document.getElementById('notas').value = p.notas;
          } else {
            alert('Paciente no encontrado');
          }
        } catch (err) {
          alert('Error al buscar paciente');
        }
      });
